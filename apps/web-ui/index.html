<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>BeatBax Web UI (Vite)</title>
  </head>
  <body>
    <div style="display:flex; align-items:center; gap:12px;">
      <h1 style="margin:0">BeatBax Browser Demo (Web UI)</h1>
      <button id="helpIcon" title="Help (H)">‚ùî</button>
    </div>
    <p style="margin-top:8px; color:#666">Paste a `.bax` file or select one to load. This demo uses the parser and the engine Player to play audio via WebAudio.</p>

    <div id="layout" class="layout" style="margin-top:12px; display:flex; gap:12px; align-items:stretch;">
      <div class="col left" style="flex:1 1 100%; min-width:320px; background:white; padding:12px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.04)">
        <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px">
          <input id="file" type="file" accept=".bax" />
          <button id="loadExample">Load sample.bax</button>
          <button id="showHelp">Show Help</button>
        </div>

        <textarea id="src" placeholder="Paste .bax source here..." style="width:100%; height:320px; font-family:monospace; font-size:13px; resize:vertical"></textarea>
        <div id="errors" style="display:none; margin-top:8px; padding:8px; background:#f8d7da; border:1px solid #dc3545; border-radius:4px; max-height:120px; overflow-y:auto;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
            <strong style="color:#721c24;">üõë Errors</strong>
            <button id="clearErrors" style="background:none; border:none; cursor:pointer; font-size:18px; line-height:1; padding:0 4px;" title="Clear errors">√ó</button>
          </div>
          <div id="errorsList" style="font-family:monospace; font-size:12px; color:#721c24;"></div>
        </div>
        <div id="warnings" style="display:none; margin-top:8px; padding:8px; background:#fff3cd; border:1px solid #ffc107; border-radius:4px; max-height:120px; overflow-y:auto;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
            <strong style="color:#856404;">‚ö†Ô∏è Warnings</strong>
            <button id="clearWarnings" style="background:none; border:none; cursor:pointer; font-size:18px; line-height:1; padding:0 4px;" title="Clear warnings">√ó</button>
          </div>
          <div id="warningsList" style="font-family:monospace; font-size:12px; color:#856404;"></div>
        </div>
        <div class="controls" style="margin-top:8px">
          <button id="play">Play</button>
          <button id="stop">Stop</button>
          <button id="apply">Apply & Play</button>
          <button id="exportWav">Export WAV</button>
          <label style="margin-left:12px"><input type="checkbox" id="live"> Live</label>
          <span id="status"></span>
        </div>
        <div id="channelControls" style="margin-top:12px"></div>
      </div>

      <div class="col right" style="flex:0 0 0%; max-width:0%; min-width:0px; overflow:hidden; transition:all 300ms ease;">
        <div id="helpPanel" style="border:1px solid #ddd; background:#fafafa; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); padding:12px;">
          <div id="helpHeader" style="display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:8px">
            <div class="left"><strong>Demo Help</strong>
              <label style="font-size:12px; color:#333; margin-left:8px">
                <input id="persistHelp" type="checkbox" style="margin-right:6px;"> Show on load
              </label>
            </div>
            <div>
              <button id="closeHelp">Close</button>
            </div>
          </div>
          <div id="helpText" style="white-space:pre-wrap; font-family:monospace; font-size:13px; max-height:60vh; overflow:auto"></div>
        </div>
      </div>
    </div>

    <!-- marked will be loaded dynamically if available; avoid static CDN tag to prevent MIME/CORS issues -->
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
